{% extends "base.html" %}

{% block title %}Dashboard - CalculiX Validation{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <div class="label">Total Tests</div>
        <div class="value">{{ stats.total_tests }}</div>
        <div class="badge {% if stats.pass_rate >= 95 %}success{% elif stats.pass_rate >= 80 %}warning{% else %}danger{% endif %}">
            {{ stats.passing_tests }} passing
        </div>
    </div>

    <div class="stat-card">
        <div class="label">Pass Rate</div>
        <div class="value">{{ "%.1f"|format(stats.pass_rate) }}%</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ stats.pass_rate }}%">
                {{ "%.0f"|format(stats.pass_rate) }}%
            </div>
        </div>
    </div>

    <div class="stat-card">
        <div class="label">Test Modules</div>
        <div class="value">{{ stats.total_modules }}</div>
        <div class="badge success">Active</div>
    </div>

    <div class="stat-card">
        <div class="label">Example Problems</div>
        <div class="value">{{ stats.total_examples }}</div>
        <div class="badge success">{{ stats.validated_examples }} validated</div>
    </div>

    <div class="stat-card">
        <div class="label">Avg Test Time</div>
        <div class="value">{{ "%.1f"|format(stats.avg_test_time_ms) }}</div>
        <div class="badge success">milliseconds</div>
    </div>

    <div class="stat-card">
        <div class="label">Lines of Code</div>
        <div class="value">{{ "{:,}".format(stats.lines_of_code) }}</div>
        <div class="badge success">Rust LOC</div>
    </div>

    <div class="stat-card">
        <div class="label">Element Types</div>
        <div class="value">{{ stats.supported_elements|length }}</div>
        {% for elem in stats.supported_elements %}
        <code>{{ elem }}</code>
        {% endfor %}
    </div>

    <div class="stat-card">
        <div class="label">Last Update</div>
        <div class="value">{{ stats.last_update.strftime('%H:%M') }}</div>
        <div class="timestamp">{{ stats.last_update.strftime('%Y-%m-%d') }}</div>
    </div>
</div>

<div class="content-box">
    <h2>üìä Key Performance Indicators</h2>
    <div class="stats-grid">
        <div>
            <strong>Test Coverage:</strong> {{ "%.1f"|format(stats.pass_rate) }}%
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ stats.pass_rate }}%"></div>
            </div>
        </div>
        <div>
            <strong>Validation Rate:</strong>
            {{ "%.1f"|format((stats.validated_examples / stats.total_examples * 100) if stats.total_examples > 0 else 0) }}%
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ (stats.validated_examples / stats.total_examples * 100) if stats.total_examples > 0 else 0 }}%"></div>
            </div>
        </div>
    </div>
</div>

<div class="content-box">
    <h2>üß™ Recent Test Runs</h2>
    <table>
        <thead>
            <tr>
                <th>Module</th>
                <th>Test Case</th>
                <th>Status</th>
                <th>Time (ms)</th>
                <th>Run Date</th>
            </tr>
        </thead>
        <tbody>
            {% for run in recent_runs %}
            <tr>
                <td><strong>{{ run.test_case.module.name }}</strong></td>
                <td>{{ run.test_case.name }}</td>
                <td class="{% if run.passed %}status-pass{% else %}status-fail{% endif %}">
                    {% if run.passed %}‚úì PASS{% else %}‚úó FAIL{% endif %}
                </td>
                <td>{{ "%.2f"|format(run.execution_time_ms) if run.execution_time_ms else 'N/A' }}</td>
                <td class="timestamp">{{ run.run_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="content-box">
    <h2>‚úÖ Recent Validation Results</h2>
    <table>
        <thead>
            <tr>
                <th>Example</th>
                <th>Element Type</th>
                <th>Metric</th>
                <th>Computed</th>
                <th>Analytical</th>
                <th>Error</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for validation in recent_validations %}
            <tr>
                <td><strong>{{ validation.example.name }}</strong></td>
                <td><code>{{ validation.example.element_type }}</code></td>
                <td>{{ validation.metric_name }}</td>
                <td>{{ "%.6f"|format(validation.computed_value) }}</td>
                <td>{{ "%.6f"|format(validation.analytical_value) if validation.analytical_value else 'N/A' }}</td>
                <td>
                    {% if validation.relative_error %}
                    {{ "%.4f"|format(validation.relative_error * 100) }}%
                    {% else %}
                    N/A
                    {% endif %}
                </td>
                <td class="{% if validation.passed %}status-pass{% else %}status-fail{% endif %}">
                    {% if validation.passed %}‚úì PASS{% else %}‚úó FAIL{% endif %}
                </td>
                <td class="timestamp">{{ validation.run_date.strftime('%Y-%m-%d %H:%M') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="content-box">
    <h2>üìà Implementation Status</h2>
    <table>
        <thead>
            <tr>
                <th>Component</th>
                <th>Status</th>
                <th>Tests</th>
                <th>Coverage</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Input Parser</strong></td>
                <td class="status-pass">‚úì Complete</td>
                <td>11</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%">100%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><strong>Mesh Builder</strong></td>
                <td class="status-pass">‚úì Complete</td>
                <td>9</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%">100%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><strong>Elements (Truss)</strong></td>
                <td class="status-pass">‚úì Complete</td>
                <td>21</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%">100%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><strong>Assembly</strong></td>
                <td class="status-pass">‚úì Complete</td>
                <td>10</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%">100%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><strong>Materials</strong></td>
                <td class="status-pass">‚úì Complete</td>
                <td>13</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%">100%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><strong>Beam Elements</strong></td>
                <td class="status-fail">‚è≥ Planned</td>
                <td>0</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%">0%</div>
                    </div>
                </td>
            </tr>
            <tr>
                <td><strong>Solid Elements</strong></td>
                <td class="status-fail">‚è≥ Planned</td>
                <td>0</td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%">0%</div>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}
