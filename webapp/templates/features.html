{% extends "base.html" %}

{% block title %}Feature Parity - CalculiX Rust Solver{% endblock %}

{% block extra_head %}
<style>
    .feature-grid {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
        gap: 0;
        margin: 2rem 0;
        overflow-x: auto;
    }

    .feature-grid > div {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #ddd;
        border-right: 1px solid #ddd;
        min-width: 100px;
    }

    .feature-grid > div:nth-child(5n+1) {
        border-left: 1px solid #ddd;
    }

    .feature-grid .header {
        background: #2c3e50;
        color: white;
        font-weight: 600;
        border-color: #34495e;
    }

    .category-header {
        background: #ecf0f1;
        font-weight: 600;
        grid-column: 1 / -1;
        border-color: #bdc3c7;
    }

    .feature-name {
        font-size: 0.95rem;
    }

    .status-icon {
        text-align: center;
        font-size: 1.2rem;
    }

    .status-full { color: #27ae60; }
    .status-partial { color: #f39c12; }
    .status-none { color: #e74c3c; }
    .status-pending { color: #95a5a6; }

    .legend {
        display: flex;
        gap: 2rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 4px;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .progress-bar {
        width: 100%;
        height: 30px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
        margin: 1rem 0;
        position: relative;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(to right, #27ae60, #2ecc71);
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
    }

    .stat-card {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        border-left: 4px solid #3498db;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #2c3e50;
    }

    .stat-label {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>Feature Parity Comparison</h2>
    <p>Comparison of features between CalculiX 2.23 (legacy) and CalculiX Rust Solver.</p>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <span class="status-icon status-full">✓</span>
            <span>Fully Implemented</span>
        </div>
        <div class="legend-item">
            <span class="status-icon status-partial">◐</span>
            <span>Partially Implemented</span>
        </div>
        <div class="legend-item">
            <span class="status-icon status-pending">⧗</span>
            <span>Planned</span>
        </div>
        <div class="legend-item">
            <span class="status-icon status-none">✗</span>
            <span>Not Implemented</span>
        </div>
    </div>

    <!-- Overall Progress -->
    <h3>Overall Implementation Progress</h3>
    <div class="progress-bar">
        <div class="progress-fill" style="width: {{ overall_progress }}%">
            {{ overall_progress }}%
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ element_types_implemented }}/{{ element_types_total }}</div>
            <div class="stat-label">Element Types</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ analysis_types_implemented }}/{{ analysis_types_total }}</div>
            <div class="stat-label">Analysis Types</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ material_models_implemented }}/{{ material_models_total }}</div>
            <div class="stat-label">Material Models</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ solver_backends }}</div>
            <div class="stat-label">Solver Backends</div>
        </div>
    </div>
</div>

<div class="card">
    <h2>Detailed Feature Comparison</h2>

    <!-- Feature Grid -->
    <div class="feature-grid">
        <!-- Headers -->
        <div class="header">Feature</div>
        <div class="header">CCX 2.23</div>
        <div class="header">Rust Solver</div>
        <div class="header">MSC.Nastran</div>
        <div class="header">Simulia Abaqus</div>

        <!-- Element Types -->
        <div class="category-header">Element Types</div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>

        <div class="feature-name">C3D8 (8-node hexahedron)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">C3D20 (20-node hexahedron)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">S4 (4-node shell)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">S8 (8-node shell)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">B31 (2-node beam)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">B32 (3-node beam)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">T3D2 (2-node truss)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">T3D3 (3-node truss)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <!-- Analysis Types -->
        <div class="category-header">Analysis Types</div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>

        <div class="feature-name">Static Linear</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Static Nonlinear (Geometry)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Static Nonlinear (Material)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Frequency (Modal)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Dynamic Time Integration</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Buckling</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Heat Transfer</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Contact Mechanics</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <!-- Material Models -->
        <div class="category-header">Material Models</div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>

        <div class="feature-name">Linear Elastic Isotropic</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Linear Elastic Orthotropic</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Plasticity (von Mises)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Hyperelastic (Neo-Hookean)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Creep</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">User Material (UMAT)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <!-- Boundary Conditions -->
        <div class="category-header">Boundary Conditions & Loads</div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>

        <div class="feature-name">Prescribed Displacements</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Concentrated Forces</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Distributed Loads (Pressure)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Distributed Loads (Surface)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Gravity Loads</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Thermal Loads</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <!-- Solvers -->
        <div class="category-header">Numerical Solvers</div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>

        <div class="feature-name">Direct (LU)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Direct (MUMPS)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Direct (PARDISO)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Direct (SPOOLES)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-none">✗</div>

        <div class="feature-name">Iterative (CG)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Iterative (GMRES)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Eigenvalue (ARPACK)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Eigenvalue (LAPACK)</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <!-- I/O & Post-Processing -->
        <div class="category-header">Input/Output</div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>
        <div class="category-header"></div>

        <div class="feature-name">INP File Parser</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">FRD Output Writer</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-none">✗</div>

        <div class="feature-name">DAT Output Writer</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">VTK Output</div>
        <div class="status-icon status-none">✗</div>
        <div class="status-icon status-pending">⧗</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Stress/Strain Extraction</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>

        <div class="feature-name">Reaction Forces</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-partial">◐</div>
        <div class="status-icon status-full">✓</div>
        <div class="status-icon status-full">✓</div>
    </div>
</div>

<div class="card">
    <h2>Implementation Notes</h2>

    <h3>Fully Implemented Features</h3>
    <ul style="line-height: 1.8;">
        <li><strong>Element Types</strong>: C3D8, S4, B31, B32, T3D2, T3D3 with full stiffness matrices</li>
        <li><strong>Analysis</strong>: Static linear, modal analysis (dense eigenvalue solver)</li>
        <li><strong>Assembly</strong>: Sparse CSR matrices, mixed DOF allocation</li>
        <li><strong>Solver</strong>: Native nalgebra LU factorization, LAPACK eigenvalue</li>
        <li><strong>I/O</strong>: INP parsing (99.6% success on 1,133 examples), basic FRD output</li>
    </ul>

    <h3>In Progress</h3>
    <ul style="line-height: 1.8;">
        <li><strong>PETSc Integration</strong>: Architecture complete, FFI pending (see <a href="/docs/petsc">PETSC_INTEGRATION.md</a>)</li>
        <li><strong>Nonlinear Geometry</strong>: Newton-Raphson solver implemented, needs element integration</li>
        <li><strong>Dynamic Analysis</strong>: Newmark time integration implemented, validation pending</li>
    </ul>

    <h3>Planned Features</h3>
    <ul style="line-height: 1.8;">
        <li><strong>Contact Mechanics</strong>: Mortar and tied contact (Phase 3)</li>
        <li><strong>Advanced Solvers</strong>: MUMPS, PARDISO, SPOOLES via PETSc</li>
        <li><strong>Material Models</strong>: Plasticity, hyperelastic, user materials</li>
        <li><strong>Thermal Analysis</strong>: Heat transfer capabilities</li>
    </ul>

    <h3>Performance Characteristics</h3>
    <table style="margin-top: 1rem;">
        <thead>
            <tr>
                <th>Metric</th>
                <th>CCX 2.23</th>
                <th>Rust Solver</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Parse Speed (1,133 files)</td>
                <td>~5 minutes</td>
                <td>~2 minutes (60% faster)</td>
            </tr>
            <tr>
                <td>Memory Safety</td>
                <td>Manual (C/Fortran)</td>
                <td>Guaranteed (Rust)</td>
            </tr>
            <tr>
                <td>Parallel Assembly</td>
                <td>OpenMP</td>
                <td>Rayon (planned)</td>
            </tr>
            <tr>
                <td>Test Coverage</td>
                <td>~30%</td>
                <td>75% (206+ tests)</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Migration Status</h2>
    <p>Active migration from CalculiX 2.23 C source (185 files remaining).</p>
    <ul style="line-height: 1.8;">
        <li>✅ Phase 1.1: String utilities ported (5 files)</li>
        <li>✅ Phase 1.2: Using nalgebra-sparse for matrix ops</li>
        <li>⏳ Phase 2.2: PETSc backend architecture complete</li>
        <li>⏸️ Phase 1.3: Residual computation (pending)</li>
        <li>⏸️ Phase 3: Contact mechanics (pending)</li>
    </ul>
    <p style="margin-top: 1rem;">
        <strong>Estimated completion</strong>: Core features (Phases 1-2) in 8-10 weeks<br>
        <strong>Production readiness</strong>: Currently 70% for supported features
    </p>
</div>
{% endblock %}
